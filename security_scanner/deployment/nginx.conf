server {
    # Port to listen on (HTTP)
    listen 80;
    
    # Domain Name - Nginx uses this to route traffic to this block
    server_name security_scanner.com;

    # ==========================================
    # SECURITY HARDENING
    # ==========================================
    
    # Hide Nginx version number from error pages to make recon harder
    server_tokens off;

    # DoS Prevention: Limit body size (e.g. for file uploads) to 10MB
    client_max_body_size 10M;
    
    # DoS Prevention: Timeouts
    # Drop connections that are idle for too long (12 seconds)
    client_body_timeout 12;
    client_header_timeout 12;

    # HTTP Security Headers
    # ---------------------
    # Prevent clickjacking
    add_header X-Frame-Options "SAMEORIGIN" always;
    
    # Enable browser XSS filtering
    add_header X-XSS-Protection "1; mode=block" always;
    
    # Prevent browser from MIME-sniffing a response away from the declared content-type
    add_header X-Content-Type-Options "nosniff" always;
    
    # Control how much referrer information is sent with requests
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    
    # Content Security Policy (CSP):
    # Only allow scripts/styles/images from 'self' (our own domain).
    add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:;" always;

    # ==========================================
    # ROUTES
    # ==========================================

    # Ignore favicon requests (keeps logs clean)
    location = /favicon.ico { access_log off; log_not_found off; }

    # Serve Static Files (CSS/JS)
    # Nginx serves these directly from the disk (faster than Django)
    location /static/ {
        alias /home/nicky/security_scanner/staticfiles/;
    }

    # Proxy everything else to Gunicorn (The Django App)
    location / {
        include proxy_params;
        # Pass requests to the Unix socket where Gunicorn is listening
        proxy_pass http://unix:/home/nicky/security_scanner/security_scanner.sock;
    }
}
